<!DOCTYPE html>
<html>
<head>
    <title>Stock Monitor</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #f1f5f9;
            margin: 0;
            padding: 30px;
            color: #1f2937;
        }

        .container {
            max-width: 1100px;
            margin: auto;
        }

        h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #111827;
        }

        h3 {
            margin-bottom: 10px;
            color: #374151;
        }

        .card {
            background: #ffffff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
        }

        input, textarea {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #d1d5db;
            font-family: monospace;
            font-size: 14px;
            box-sizing: border-box;
        }

        textarea {
            resize: vertical;
        }

        .btn {
            padding: 10px 18px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            margin-right: 10px;
        }

        .btn-primary {
            background: #2563eb;
            color: white;
        }

        .btn-danger {
            background: #dc2626;
            color: white;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-clear {
            background: #f97316;
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .logBox {
            height: 260px;
            overflow-y: auto;
            white-space: pre-wrap;
            background: #0f172a;
            color: #e5e7eb;
            padding: 15px;
            border-radius: 10px;
            font-size: 13px;
        }

        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        @media (max-width: 900px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

<div class="container">

    <h2>üì¶ IQOO Stock Monitor</h2>

    <!-- Buy Now Selector -->
    <div class="card">
        <h3>üîç Buy Now CSS Selector</h3>
        <input id="buyNowPath" type="text" placeholder="e.g. div.btn-buynow.btn">
        <br><br>
        <button class="btn btn-primary" onclick="saveXpath()">Save Selector</button>
    </div>

    <!-- URLs -->
    <div class="card">
        <h3>üîó Product URLs</h3>
        <textarea id="urls" rows="6" placeholder="Paste product URLs (one per line)"></textarea>
        <br><br>
        <button class="btn btn-primary" onclick="start()">‚ñ∂ START</button>
        <button class="btn btn-danger" onclick="stop()">‚èπ STOP</button>
    </div>

    <!-- Logs -->
    <div class="grid">

        <!-- Live Logs -->
        <div class="card">
            <div class="log-header">
                <h3>üìä Live Logs</h3>
                <button class="btn btn-clear" onclick="clearLive()">Clear</button>
            </div>
            <div id="liveBox" class="logBox"></div>
        </div>

        <!-- Buy Logs -->
        <div class="card">
            <div class="log-header">
                <h3>üéâ Buy Now Logs</h3>
                <button class="btn btn-clear" onclick="clearBuy()">Clear</button>
            </div>
            <div id="buyBox" class="logBox"></div>
        </div>

    </div>

</div>

<script>
function start() {
    fetch('/start', {
        method: 'POST',
        headers: {'Content-Type': 'text/plain'},
        body: document.getElementById('urls').value
    });
}

function stop() {
    fetch('/stop', {method:'POST'});
}

function clearLive() {
    fetch('/logs/live/clear', {method:'POST'});
    document.getElementById("liveBox").innerText = "";
}

function clearBuy() {
    fetch('/logs/buynow/clear', {method:'POST'});
    document.getElementById("buyBox").innerText = "";
}

function saveXpath() {
    fetch('/xpaths', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({
            buyNow: document.getElementById('buyNowPath').value
        })
    });
}

function loadXpath() {
    fetch('/xpaths')
        .then(r => r.json())
        .then(d => document.getElementById('buyNowPath').value = d.buyNow || '');
}

setInterval(() => {
    fetch('/logs/live')
        .then(r => r.json())
        .then(d => {
            const box = document.getElementById("liveBox");
            box.innerText = d.join("\n");
            box.scrollTop = box.scrollHeight;
        });

    fetch('/logs/buynow')
        .then(r => r.json())
        .then(d => {
            const box = document.getElementById("buyBox");
            box.innerText = d.join("\n");
            box.scrollTop = box.scrollHeight;
        });
}, 2000);

loadXpath();
</script>

</body>
</html>
